<!DOCTYPE html>
<html>
<head>
	<title>MUN Helper</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

	<!-- jQuery library -->
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
	<script type="text/javascript" src="script.js"></script>
	<script src="https://cdn.firebase.com/js/client/2.4.0/firebase.js"></script>

	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<style>
		.form-group {
			padding-left: 20%;
			padding-right: 20%;
		}
	</style>
</head>
<body>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="index.html">MUN Helper</a>
			</div>
		</div><!-- /.container-fluid -->
	</nav>
	<script>
		function validEmail(email) {
			var re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
			return re.test(email)
		}

		function createAccount() {
			var email = document.getElementsByName("email")[0].value
			var pass = document.getElementsByName("password")[0].value
			var pass2 = document.getElementsByName("password-confirm")[0].value
			if (!validEmail(email)) {
				window.alert("Please enter a valid email")
				console.log("Invalid email")
				return
			}
			else if (pass !== pass2) {
				window.alert("Passwords do not match")
				console.log("unmatching passwords")
				return
			}
			else {
				var firebase = new Firebase("https://munhelper.firebaseio.com/")
				firebase.createUser({
					email    : email,
					password : pass
				}, function(error, userData) {
					if (error) {
						console.log("Error creating user:", error);
					} else {
						console.log("Successfully created user account with uid:", userData.uid);
						firebase.authWithPassword({
							"email": email,
							"password": pass
						}, function(error, authData) {
							if (error) {
								console.log("Login Failed!", error);
							} else {
								window.alert("Created account!")
								console.log("Authenticated successfully with payload:", authData);
								var ref = new Firebase("https://munhelper.firebaseio.com/users")
								var data = {};
								data[email.replace(".", "_").replace("#", "_").replace("$", "_").replace("/", "_").replace("[", "_").replace(".", "]")] = userData.uid;
								ref.update(data, function(error) {
									if (error) {
										console.log('Synchronization failed');
									} else {
										console.log('Synchronization succeeded');
										window.location.replace("newcommittees.html");
									}
								});
							}
						});
					}
				});
			}
		}
	</script>
	<div class="form-group">
		<label for="usr">Email:</label>
		<input type="text" class="form-control" id="eml" name="email">
	</div>
	<div class="form-group">
		<label for="pwd">Password:</label>
		<input type="password" class="form-control" id="pwd" name="password">
	</div>
	<div class="form-group">
		<label for="pwd">Confirm Password:</label>
		<input type="password" class="form-control" id="pwd" name="password-confirm">
	</div>
	<div style="text-align: center;">
		<a class="btn btn-primary" onclick="createAccount();" name="submit">Create</a>
	</div>
</body>
</html>